<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LRC转SRT工具</title>
<style>
body {
    font-family: sans-serif;
    background: #f4f4f9;
    padding: 20px;
    color: #333;
}
h1 {
    text-align: center;
    color: #2c3e50;
}
.container {
    max-width: 800px;
    margin: 0 auto;
    background: white;
    border-radius: 8px;
    padding: 20px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}
textarea {
    width: 100%;
    height: 200px;
    padding: 10px;
    border-radius: 6px;
    border: 1px solid #ccc;
    font-family: monospace;
    font-size: 14px;
    resize: vertical;
}
button {
    padding: 10px 20px;
    margin: 8px 5px 0 0;
    border: none;
    border-radius: 4px;
    background: #3498db;
    color: white;
    cursor: pointer;
}
button:hover {
    background: #2980b9;
}
button.secondary {
    background: #7f8c8d;
}
button.secondary:hover {
    background: #707b7c;
}
.stats {
    font-size: 0.9em;
    color: #666;
    margin-top: 5px;
}
</style>
</head>
<body>
<div class="container">
    <h1>LRC → SRT 转换</h1>

    <div>
        <input type="file" id="lrc-file" accept=".lrc">
        <button id="example-btn" class="secondary">加载示例</button>
    </div>

    <h3>输入区 (LRC格式)</h3>
    <textarea id="lrc-input" placeholder="粘贴LRC内容或上传文件..."></textarea>
    <div class="stats" id="lrc-stats"></div>
    <button id="convert-btn">转换为SRT</button>
    <button id="clear-input" class="secondary">清空</button>

    <h3>输出区 (SRT格式)</h3>
    <textarea id="srt-output" placeholder="转换结果将显示在此处..." readonly></textarea>
    <div class="stats" id="srt-stats"></div>
    <button id="copy-btn">复制结果</button>
    <button id="download-btn">下载SRT</button>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const lrcInput = document.getElementById('lrc-input');
    const srtOutput = document.getElementById('srt-output');
    const lrcFileInput = document.getElementById('lrc-file');
    const convertBtn = document.getElementById('convert-btn');
    const clearBtn = document.getElementById('clear-input');
    const exampleBtn = document.getElementById('example-btn');
    const copyBtn = document.getElementById('copy-btn');
    const downloadBtn = document.getElementById('download-btn');
    const lrcStats = document.getElementById('lrc-stats');
    const srtStats = document.getElementById('srt-stats');

    let originalFilename = 'converted';

    function updateStats() {
        lrcStats.textContent = `行数：${lrcInput.value.split('\n').length} | 字符：${lrcInput.value.length}`;
        srtStats.textContent = `行数：${srtOutput.value.split('\n').length} | 字符：${srtOutput.value.length}`;
    }

    lrcInput.addEventListener('input', updateStats);

    lrcFileInput.addEventListener('change', e => {
        const file = e.target.files[0];
        if (!file) return;
        originalFilename = file.name.replace(/\.lrc$/i, '');
        const reader = new FileReader();
        reader.onload = e => {
            lrcInput.value = e.target.result;
            updateStats();
        };
        reader.readAsText(file, 'utf-8');
    });

    exampleBtn.addEventListener('click', () => {
        lrcInput.value = `[00:00.00]Hello World
[00:05.00]This is an example line
[00:10.00]Converted to SRT format`;
        updateStats();
    });

    clearBtn.addEventListener('click', () => {
        lrcInput.value = '';
        srtOutput.value = '';
        updateStats();
    });

    function lrcToSrt(lrcText) {
        const lines = lrcText.split('\n');
        const timeEntries = [];
        const regex = /\[(\d+):(\d+)(?:\.(\d+))?\]/g;

        lines.forEach(line => {
            const matches = [...line.matchAll(regex)];
            let text = line.replace(regex, '').trim();
            if (!text) return;
            for (const match of matches) {
                const m = parseInt(match[1]);
                const s = parseInt(match[2]);
                const ms = match[3] ? parseInt(match[3].padEnd(3, '0')) : 0;
                const total = m * 60 + s + ms / 1000;
                timeEntries.push({ time: total, text });
            }
        });

        timeEntries.sort((a, b) => a.time - b.time);
        const srtLines = [];
        timeEntries.forEach((entry, i) => {
            const start = formatTime(entry.time);
            const end = formatTime(
                i < timeEntries.length - 1 ? timeEntries[i + 1].time : entry.time + 5
            );
            srtLines.push(`${i + 1}`);
            srtLines.push(`${start} --> ${end}`);
            srtLines.push(entry.text, '');
        });
        return srtLines.join('\n');
    }

    function formatTime(sec) {
        const h = String(Math.floor(sec / 3600)).padStart(2, '0');
        const m = String(Math.floor((sec % 3600) / 60)).padStart(2, '0');
        const s = String(Math.floor(sec % 60)).padStart(2, '0');
        const ms = String(Math.floor((sec * 1000) % 1000)).padStart(3, '0');
        return `${h}:${m}:${s},${ms}`;
    }

    convertBtn.addEventListener('click', () => {
        const lrcText = lrcInput.value.trim();
        if (!lrcText) {
            alert('请输入LRC内容');
            return;
        }
        const srtText = lrcToSrt(lrcText);
        srtOutput.value = srtText;
        updateStats();
    });

    copyBtn.addEventListener('click', () => {
        if (!srtOutput.value) return alert('没有可复制的内容');
        srtOutput.select();
        document.execCommand('copy');
        alert('已复制到剪贴板');
    });

    downloadBtn.addEventListener('click', () => {
        if (!srtOutput.value) return alert('没有内容可下载');
        const blob = new Blob([srtOutput.value], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `${originalFilename}.srt`;
        a.click();
        URL.revokeObjectURL(url);
    });

    updateStats();
});
</script>
</body>
</html>
