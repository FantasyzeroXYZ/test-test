<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VAMplayer</title>
    <link rel="icon" href="./assets/VAMplayer_logo.ico" type="image/x-icon">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="./css/style.css">
</head>
<body>
    <header>
        <h1>VAMplayer</h1>
        <p class="subtitle">支持视频/音频播放、字幕显示与Anki卡片生成功能</p>
    </header>
    
    <div class="container">
        <section class="anki-section">
            <div class="anki-container">
                <div class="anki-status-row">
                    <div class="anki-status">
                        <div class="status-indicator" id="anki-status-indicator"></div>
                        <span id="anki-status-text">检查Anki连接状态...</span>
                    </div>
                    <div class="anki-controls">
                        <button class="anki-btn" id="check-anki-btn">状态</button>
                        <button class="anki-btn" id="show-config-btn">配置</button>
                    </div>
                </div>
                
                <!-- 顶部控制按钮 -->
                <div class="top-controls">
                    <button class="media-mode-btn" id="media-mode-btn">
                        <i class="fas fa-video"></i> 视频模式
                    </button>
                    <button class="language-mode-btn" id="language-mode-btn">
                        <i class="fas fa-language"></i> 英语模式
                    </button>
                    <div class="import-controls">
                        <button class="import-btn" id="subtitle-import-btn">
                            <i class="fas fa-closed-captioning"></i> 字幕
                        </button>
                        <button class="import-btn" id="media-import-btn">
                            <i class="fas fa-file-video"></i> 视频
                        </button>
                    </div>
                </div>
                
                <input type="file" id="video-file-input" accept="video/*" class="hidden">
                <input type="file" id="audio-file-input" accept="audio/*" class="hidden">
                <input type="file" id="subtitle-file-input" accept=".srt,.vtt,.txt" class="hidden">
                
                <div class="auto-config-section hidden" id="auto-config-section">
                    <div class="auto-config-row">
                        <label class="auto-config-label" for="deck-select">牌组:</label>
                        <select class="auto-config-select" id="deck-select">
                            <option value="">加载中...</option>
                        </select>
                    </div>
                    <div class="auto-config-row">
                        <label class="auto-config-label" for="model-select">笔记类型:</label>
                        <select class="auto-config-select" id="model-select">
                            <option value="">加载中...</option>
                        </select>
                    </div>
                    <div class="auto-config-row">
                        <label class="auto-config-label" for="word-field-select">单词字段:</label>
                        <select class="auto-config-select" id="word-field-select">
                            <option value="">加载中...</option>
                        </select>
                    </div>
                    <div class="auto-config-row">
                        <label class="auto-config-label" for="sentence-field-select">句子字段:</label>
                        <select class="auto-config-select" id="sentence-field-select">
                            <option value="">加载中...</option>
                        </select>
                    </div>
                    <div class="auto-config-row">
                        <label class="auto-config-label" for="definition-field-select">释义字段:</label>
                        <select class="auto-config-select" id="definition-field-select">
                            <option value="">加载中...</option>
                        </select>
                    </div>
                    <div class="auto-config-row">
                        <label class="auto-config-label" for="audio-field-select">音频字段:</label>
                        <select class="auto-config-select" id="audio-field-select">
                            <option value="">加载中...</option>
                        </select>
                    </div>
                    <div class="auto-config-row">
                        <label class="auto-config-label" for="image-field-select">图片字段:</label>
                        <select class="auto-config-select" id="image-field-select">
                            <option value="">加载中...</option>
                        </select>
                    </div>
                </div>
            </div>
        </section>
        
        <section class="player-section">
            <div class="player-container">
                <div class="audio-info">
                    <div class="album-art">
                        <i id="media-icon">▶</i>
                    </div>
                    <div class="track-info">
                        <h2 id="track-title">请选择媒体文件</h2>
                        <p id="track-description">支持 MP4, AVI, MKV, MP3, WAV 等格式</p>
                    </div>
                </div>
                
                <div class="video-player" id="video-player">
                    <video id="player" controls>
                        <!-- 视频源将通过JavaScript动态设置 -->
                    </video>
                    <div class="video-subtitles" id="video-subtitles">
                        <!-- 视频内字幕将动态生成 -->
                    </div>
                </div>
                
                <div class="audio-player" id="audio-player">
                    <div class="audio-player-container">
                        <div class="audio-controls">
                            <div class="audio-progress-container">
                                <span class="audio-time" id="audio-current-time">0:00</span>
                                <div class="audio-progress" id="audio-progress">
                                    <div class="audio-progress-filled" id="audio-progress-filled"></div>
                                    <div class="progress-thumb" id="progress-thumb"></div>
                                </div>
                                <span class="audio-time" id="audio-duration">0:00</span>
                            </div>
                            <div class="audio-volume-container">
                                <span>🔊</span>
                                <div class="audio-volume" id="audio-volume">
                                    <div class="audio-volume-filled" id="audio-volume-filled"></div>
                                    <div class="volume-thumb" id="volume-thumb"></div>
                                </div>
                            </div>
                            <div class="audio-buttons">
                                <button class="audio-btn" id="audio-play-pause-btn">▶</button>
                            </div>
                        </div>
                    </div>
                    <div class="audio-subtitles" id="audio-subtitles">
                        <!-- 音频滚动字幕将动态生成 -->
                    </div>
                </div>
                
                <div class="video-controls">
                    <button class="control-btn" id="prev-sentence-btn" title="上一句">
                        <i class="fas fa-step-backward"></i>
                    </button>
                    <button class="control-btn" id="next-sentence-btn" title="下一句">
                        <i class="fas fa-step-forward"></i>
                    </button>
                    <button class="control-btn" id="toggle-video-subtitles-btn" title="切换视频内字幕">
                        <i class="fas fa-closed-captioning"></i>
                    </button>
                    <button class="control-btn" id="show-subtitle-list-btn" title="全部字幕">
                        <i class="fas fa-list"></i>
                    </button>
                    <button class="control-btn" id="toggle-audio-subtitles-btn" title="切换音频字幕">
                        <i class="fas fa-volume-up"></i>
                    </button>
                    <div class="time-input-container">
                        <input type="number" class="time-input" id="time-jump-input" placeholder="时间(秒)" step="0.1" min="0">
                        <button class="time-jump-btn" id="time-jump-btn">跳转</button>
                    </div>
                </div>
            </div>
        </section>
        
        <section class="subtitle-section">
            <div class="subtitle-display" id="subtitle-display">
                <div class="subtitle-text" id="subtitle-text">
                    无字幕
                </div>
            </div>
            <div class="subtitle-controls">
                <button class="subtitle-btn" id="toggle-subtitle-btn">显示/隐藏字幕</button>
            </div>
            <p class="hint">提示：直接点击字幕中的单词，该单词会自动查询并显示释义</p>
        </section>
        
        <div class="github-link">
            <a href="https://github.com/FantasyzeroXYZ/VAMplayer" target="_blank" title="查看项目源码">
                <i class="fab fa-github"></i>
            </a>
        </div>
    </div>
    
    <!-- 底部弹出面板 -->
    <div class="panel-overlay" id="panel-overlay"></div>
    <div class="dictionary-panel" id="dictionary-panel">
        <div class="panel-header">
            <div class="panel-title" id="panel-word-title">单词查询</div>
            <button class="close-panel" id="close-panel">×</button>
        </div>
        
        <!-- 修复：搜索和Anki按钮并排 - 使用图标 -->
        <div class="panel-search-anki-container">
            <div class="panel-search-container">
                <input type="text" class="panel-search-input" id="panel-search-input" placeholder="输入要查询的单词...">
                <button class="panel-search-btn" id="panel-search-btn">
                    <i class="fas fa-search"></i>
                </button>
                <button class="append-word-btn" id="append-word-btn" title="追加词汇">
                    <i class="fas fa-plus"></i>
                </button>
                <button class="panel-anki-btn" id="panel-add-to-anki-btn" title="添加到Anki">
                    <img src="./assets/icons8-anki-24.png" alt="Anki" class="anki-icon">
                </button>
            </div>
        </div>
        
        <div class="original-sentence" id="original-sentence">
            原句将显示在这里...
        </div>
        
        <!-- 标签页导航 默认标签页active-->  
        <div class="dictionary-tabs">
            <button class="tab-button active" data-tab="dictionary-tab">词典释义</button>
            <button class="tab-button" data-tab="web-tab">网页查询</button>
            <button class="tab-button" data-tab="custom-tab">自定义释义</button>
        </div>
        
        <!-- 标签页内容 默认标签页active-->
        <div class="tab-content">
            <div id="dictionary-tab" class="tab-pane active">
                <div class="dictionary-result" id="panel-dictionary-result">
                    查询结果将显示在这里...
                </div>
            </div>
            <div id="custom-tab" class="tab-pane">
                <div class="custom-definition">
                    <textarea id="panel-custom-definition-input" placeholder="如果查词没有返回内容或者想自定义释义内容，请在此输入..."></textarea>
                </div>
            </div>
            <div id="web-tab" class="tab-pane">
                <div class="dictionary-result" id="panel-web-result">
                    <iframe id="web-search-frame" style="width: 100%; height: 300px; border: none;" src="about:blank"></iframe>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 字幕列表面板 -->
    <div class="subtitle-list-panel" id="subtitle-list-panel">
        <div class="panel-header">
            <div class="panel-title">全部字幕</div>
            <button class="close-panel" id="close-subtitle-list-panel">×</button>
        </div>
        
        <ul class="subtitle-list" id="subtitle-list">
            <!-- 字幕列表将动态生成 -->
        </ul>
    </div>
    
    <footer>
        <p>网页媒体播放器 - 专为语言学习设计</p>
    </footer>

    <!-- 引入kuromoji JS库 -->
    <script src="./kuromoji/build/kuromoji.js"></script>
    <script src="./js/script.js"></script>
</body>
</html>