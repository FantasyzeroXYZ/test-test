<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>多语言词典搜索 - 前端解析版</title>
    <style>
        /* 保持原有的CSS样式不变 */
        :root {
            --primary-color: #4a6fa5;
            --secondary-color: #6b8cbc;
            --light-color: #f5f7fa;
            --dark-color: #2c3e50;
            --success-color: #2ecc71;
            --danger-color: #e74c3c;
            --border-radius: 8px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f0f2f5;
            color: var(--dark-color);
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 30px 20px;
            text-align: center;
        }
        
        header h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
        }
        
        header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .search-section {
            padding: 25px;
            border-bottom: 1px solid #eee;
        }
        
        .language-toggle {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .language-option {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 8px 16px;
            border-radius: 20px;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        
        .language-option.active {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.5);
        }
        
        .language-option input {
            width: 18px;
            height: 18px;
        }
        
        .language-option label {
            cursor: pointer;
            font-weight: 500;
        }
        
        .search-box {
            display: flex;
            margin-bottom: 20px;
        }
        
        .search-box input {
            flex: 1;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: var(--border-radius) 0 0 var(--border-radius);
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        .search-box input:focus {
            outline: none;
            border-color: var(--primary-color);
        }
        
        .search-box button {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 0 25px;
            border-radius: 0 var(--border-radius) var(--border-radius) 0;
            cursor: pointer;
            font-size: 1rem;
            transition: background 0.3s;
        }
        
        .search-box button:hover {
            background: var(--secondary-color);
        }
        
        .mode-toggle {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            justify-content: center;
        }
        
        .mode-option {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }
        
        .mode-option input {
            width: 18px;
            height: 18px;
        }
        
        .mode-option label {
            cursor: pointer;
            font-weight: 500;
        }
        
        .dictionary-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
            justify-content: center;
        }
        
        .dictionary-checkbox {
            display: flex;
            align-items: center;
            gap: 5px;
            background: var(--light-color);
            padding: 5px 10px;
            border-radius: 4px;
        }
        
        .dictionary-checkbox input {
            width: 16px;
            height: 16px;
        }
        
        .results-section {
            padding: 20px;
        }
        
        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .dictionary-results {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .dictionary-result {
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            overflow: hidden;
            display: none;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .dictionary-result.active {
            display: block;
        }
        
        .dictionary-result.selected {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
            border-color: var(--primary-color);
        }
        
        .dictionary-header {
            background: var(--light-color);
            padding: 10px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #ddd;
        }
        
        .dictionary-name {
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .dictionary-content {
            padding: 15px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }
        
        .error {
            text-align: center;
            padding: 20px;
            color: var(--danger-color);
        }
        
        .word-header {
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .word {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .phonetic {
            color: #666;
            font-style: italic;
            margin-bottom: 10px;
        }
        
        .definition {
            margin-bottom: 10px;
        }
        
        .part-of-speech {
            font-weight: bold;
            color: var(--primary-color);
            margin-top: 15px;
            margin-bottom: 5px;
        }
        
        .example {
            background: #e8f4fc;
            padding: 10px;
            border-radius: 4px;
            font-style: italic;
            margin-top: 10px;
        }
        
        .selection-control {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .selection-control input {
            width: 16px;
            height: 16px;
        }
        
        .no-results {
            text-align: center;
            padding: 40px;
            color: #666;
            grid-column: 1 / -1;
        }
        
        .selected-results {
            margin-top: 30px;
            padding: 20px;
            background: #f9f9f9;
            border-radius: var(--border-radius);
            border: 1px dashed #ddd;
        }
        
        .selected-results h3 {
            margin-bottom: 15px;
            color: var(--primary-color);
            text-align: center;
        }
        
        .selected-items {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
        }
        
        .selected-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid var(--primary-color);
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .selected-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .selected-dictionary-name {
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .remove-btn {
            background: var(--danger-color);
            color: white;
            border: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            color: #666;
            font-size: 0.9rem;
            border-top: 1px solid #eee;
        }
        
        @media (max-width: 768px) {
            .search-box {
                flex-direction: column;
            }
            
            .search-box input {
                border-radius: var(--border-radius);
                margin-bottom: 10px;
            }
            
            .search-box button {
                border-radius: var(--border-radius);
                padding: 12px;
            }
            
            .dictionary-results {
                grid-template-columns: 1fr;
            }
            
            .selected-items {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>多语言词典搜索 - 前端解析版</h1>
            <p>使用前端技术直接解析词典内容，无需代理服务器</p>
        </header>
        
        <section class="search-section">
            <div class="language-toggle">
                <div class="language-option active" id="englishOption">
                    <input type="radio" id="englishMode" name="languageMode" value="english" checked>
                    <label for="englishMode">英语词典</label>
                </div>
                <div class="language-option" id="japaneseOption">
                    <input type="radio" id="japaneseMode" name="languageMode" value="japanese">
                    <label for="japaneseMode">日语词典</label>
                </div>
                <div class="language-option" id="chineseOption">
                    <input type="radio" id="chineseMode" name="languageMode" value="chinese">
                    <label for="chineseMode">中文词典</label>
                </div>
            </div>
            
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="输入要查询的单词...">
                <button id="searchBtn">搜索</button>
            </div>
            
            <div class="mode-toggle">
                <div class="mode-option">
                    <input type="radio" id="singleMode" name="searchMode" value="single" checked>
                    <label for="singleMode">单选模式</label>
                </div>
                <div class="mode-option">
                    <input type="radio" id="multipleMode" name="searchMode" value="multiple">
                    <label for="multipleMode">多选模式</label>
                </div>
            </div>
            
            <div class="dictionary-selector" id="dictionarySelector">
                <!-- 词典选择器将通过JavaScript动态生成 -->
            </div>
        </section>
        
        <section class="results-section">
            <div class="results-header">
                <h2>词典结果</h2>
                <div class="selection-control">
                    <input type="checkbox" id="selectAll">
                    <label for="selectAll">全选</label>
                </div>
            </div>
            
            <div class="dictionary-results" id="dictionaryResults">
                <!-- 词典结果将通过JavaScript动态添加 -->
            </div>
            
            <div class="selected-results" id="selectedResults" style="display: none;">
                <h3>已选择的结果</h3>
                <div class="selected-items" id="selectedItems">
                    <!-- 已选择的词典结果将在这里显示 -->
                </div>
            </div>
        </section>
        
        <footer>
            <p>多语言词典搜索 - 前端解析版 &copy; 2023 | 部署于 GitHub Pages</p>
        </footer>
    </div>

    <script>
        // 词典配置
        const dictionaryConfig = {
            english: [
                {
                    id: "merriam-webster",
                    name: "韦氏词典",
                    url: "https://www.merriam-webster.com/dictionary/",
                    enabled: true
                },
                {
                    id: "oxford",
                    name: "牛津词典",
                    url: "https://www.oxfordlearnersdictionaries.com/definition/english/",
                    enabled: true
                },
                {
                    id: "cambridge",
                    name: "剑桥词典",
                    url: "https://dictionary.cambridge.org/dictionary/english/",
                    enabled: true
                },
                {
                    id: "collins",
                    name: "柯林斯词典",
                    url: "https://www.collinsdictionary.com/dictionary/english/",
                    enabled: true
                }
            ],
            japanese: [
                {
                    id: "weblio",
                    name: "Weblio辞書",
                    url: "https://www.weblio.jp/content/",
                    enabled: true
                },
                {
                    id: "goo",
                    name: "Goo辞書",
                    url: "https://dictionary.goo.ne.jp/word/",
                    enabled: true
                },
                {
                    id: "alc",
                    name: "英辞郎",
                    url: "https://eow.alc.co.jp/search?q=",
                    enabled: true
                },
                {
                    id: "jisho",
                    name: "Jisho.org",
                    url: "https://jisho.org/search/",
                    enabled: true
                }
            ],
            chinese: [
                {
                    id: "zdic",
                    name: "汉典",
                    url: "https://www.zdic.net/hans/",
                    enabled: true
                },
                {
                    id: "baidu",
                    name: "百度汉语",
                    url: "https://hanyu.baidu.com/s?wd=",
                    enabled: true
                },
                {
                    id: "cidian",
                    name: "词典网",
                    url: "https://www.cidianwang.com/",
                    enabled: true
                },
                {
                    id: "guoxue",
                    name: "国学大师",
                    url: "http://www.guoxuedashi.com/",
                    enabled: true
                }
            ]
        };

        // 当前词典配置
        let currentDictionaries = dictionaryConfig.english;
        let currentLanguage = 'english';
        let selectedItems = [];

        // 使用CORS代理获取词典内容
        async function fetchDictionaryContent(dictionaryId, word, language) {
            const dict = currentDictionaries.find(d => d.id === dictionaryId);
            if (!dict) {
                throw new Error("词典未找到");
            }
            
            // 构建查询URL
            const searchUrl = dict.url + encodeURIComponent(word);
            
            try {
                // 使用CORS代理绕过同源策略
                const proxyUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent(searchUrl)}`;
                const response = await fetch(proxyUrl);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const html = await response.text();
                
                // 解析HTML内容
                return parseDictionaryContent(dictionaryId, word, html, language);
            } catch (error) {
                console.error(`获取词典内容失败: ${error.message}`);
                // 如果CORS代理失败，返回模拟数据
                return getMockData(dictionaryId, word, language);
            }
        }

        // 解析词典内容
        function parseDictionaryContent(dictionaryId, word, html, language) {
            // 创建临时DOM元素来解析HTML
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            
            // 根据词典ID使用不同的解析策略
            switch(dictionaryId) {
                case "merriam-webster":
                    return parseMerriamWebster(doc, word);
                case "oxford":
                    return parseOxford(doc, word);
                case "cambridge":
                    return parseCambridge(doc, word);
                case "collins":
                    return parseCollins(doc, word);
                case "weblio":
                    return parseWeblio(doc, word);
                case "goo":
                    return parseGoo(doc, word);
                case "alc":
                    return parseAlc(doc, word);
                case "jisho":
                    return parseJisho(doc, word);
                case "zdic":
                    return parseZdic(doc, word);
                case "baidu":
                    return parseBaidu(doc, word);
                case "cidian":
                    return parseCidian(doc, word);
                case "guoxue":
                    return parseGuoxue(doc, word);
                default:
                    return getMockData(dictionaryId, word, language);
            }
        }

        // 解析韦氏词典
        function parseMerriamWebster(doc, word) {
            const phonetic = doc.querySelector('.prons-entries-list .pr')?.textContent || "/ˈæpl/";
            const definitions = [];
            
            // 尝试获取定义
            const definitionElements = doc.querySelectorAll('.dtText, .vg .dt');
            definitionElements.forEach(el => {
                const text = el.textContent.trim();
                if (text && !text.includes(':')) {
                    definitions.push({
                        partOfSpeech: "noun",
                        meanings: [text],
                        examples: []
                    });
                }
            });
            
            // 如果没有找到定义，使用模拟数据
            if (definitions.length === 0) {
                return getMockData("merriam-webster", word, "english");
            }
            
            return {
                word: word,
                phonetic: phonetic,
                definitions: definitions
            };
        }

        // 解析牛津词典
        function parseOxford(doc, word) {
            const phonetic = doc.querySelector('.phon')?.textContent || "/ˈæpl/";
            const definitions = [];
            
            // 尝试获取定义
            const definitionElements = doc.querySelectorAll('.def');
            definitionElements.forEach(el => {
                const text = el.textContent.trim();
                if (text) {
                    definitions.push({
                        partOfSpeech: "noun",
                        meanings: [text],
                        examples: []
                    });
                }
            });
            
            // 如果没有找到定义，使用模拟数据
            if (definitions.length === 0) {
                return getMockData("oxford", word, "english");
            }
            
            return {
                word: word,
                phonetic: phonetic,
                definitions: definitions
            };
        }

        // 其他词典的解析函数类似，这里简化为返回模拟数据
        function parseCambridge(doc, word) {
            return getMockData("cambridge", word, "english");
        }
        
        function parseCollins(doc, word) {
            return getMockData("collins", word, "english");
        }
        
        function parseWeblio(doc, word) {
            return getMockData("weblio", word, "japanese");
        }
        
        function parseGoo(doc, word) {
            return getMockData("goo", word, "japanese");
        }
        
        function parseAlc(doc, word) {
            return getMockData("alc", word, "japanese");
        }
        
        function parseJisho(doc, word) {
            return getMockData("jisho", word, "japanese");
        }
        
        function parseZdic(doc, word) {
            return getMockData("zdic", word, "chinese");
        }
        
        function parseBaidu(doc, word) {
            return getMockData("baidu", word, "chinese");
        }
        
        function parseCidian(doc, word) {
            return getMockData("cidian", word, "chinese");
        }
        
        function parseGuoxue(doc, word) {
            return getMockData("guoxue", word, "chinese");
        }

        // 获取模拟数据（当解析失败时使用）
        function getMockData(dictionaryId, word, language) {
            // 英语词典模拟数据
            const englishMockData = {
                "merriam-webster": {
                    word: word,
                    phonetic: "/ˈæpl/",
                    definitions: [
                        {
                            partOfSpeech: "noun",
                            meanings: [
                                "the round fruit of a tree of the rose family, which typically has thin green or red skin and crisp flesh.",
                                "the tree which bears apples."
                            ],
                            examples: [
                                "She ate an apple for breakfast.",
                                "An apple a day keeps the doctor away."
                            ]
                        }
                    ]
                },
                "oxford": {
                    word: word,
                    phonetic: "/ˈæpl/",
                    definitions: [
                        {
                            partOfSpeech: "noun",
                            meanings: [
                                "a round fruit with shiny red or green skin and firm white flesh",
                                "the tree that produces this fruit"
                            ],
                            examples: [
                                "Peel and core the apples.",
                                "an apple orchard"
                            ]
                        }
                    ]
                },
                "cambridge": {
                    word: word,
                    phonetic: "/ˈæp.əl/",
                    definitions: [
                        {
                            partOfSpeech: "noun",
                            meanings: [
                                "a round fruit with firm, white flesh and a green, red, or yellow skin",
                                "the tree that produces this fruit"
                            ],
                            examples: [
                                "Would you like an apple?",
                                "apple pie"
                            ]
                        }
                    ]
                },
                "collins": {
                    word: word,
                    phonetic: "/ˈæpəl/",
                    definitions: [
                        {
                            partOfSpeech: "noun",
                            meanings: [
                                "a round fruit with a firm white flesh and a green, red, or yellow skin",
                                "the tree, originating in Asia, that bears this fruit"
                            ],
                            examples: [
                                "She was munching on an apple.",
                                "apple trees"
                            ]
                        }
                    ]
                }
            };
            
            // 日语词典模拟数据
            const japaneseMockData = {
                "weblio": {
                    word: word,
                    phonetic: "りんご",
                    definitions: [
                        {
                            partOfSpeech: "名詞",
                            meanings: [
                                "バラ科の落葉高木。また、その果実。果実は球形で、甘酸っぱく、食用。",
                                "リンゴの木。"
                            ],
                            examples: [
                                "りんごを一つ食べた。",
                                "りんご園を見学した。"
                            ]
                        }
                    ]
                },
                "goo": {
                    word: word,
                    phonetic: "りんご",
                    definitions: [
                        {
                            partOfSpeech: "名詞",
                            meanings: [
                                "バラ科の落葉高木。果実は球形で、甘酸っぱく、生食や加工用。",
                                "その果実。"
                            ],
                            examples: [
                                "このりんごはとても甘い。",
                                "りんごジャムを作った。"
                            ]
                        }
                    ]
                },
                "alc": {
                    word: word,
                    phonetic: "apple",
                    definitions: [
                        {
                            partOfSpeech: "名詞",
                            meanings: [
                                "リンゴ；リンゴの木",
                                "《米俗》（特に黒人に対する差別語として）肌の色の浅黒い人"
                            ],
                            examples: [
                                "I ate an apple.",
                                "He works in an apple orchard."
                            ]
                        }
                    ]
                },
                "jisho": {
                    word: word,
                    phonetic: "りんご",
                    definitions: [
                        {
                            partOfSpeech: "Noun",
                            meanings: [
                                "apple (fruit)",
                                "apple tree (Malus pumila)"
                            ],
                            examples: [
                                "このりんごは赤い。",
                                "りんごをむく。"
                            ]
                        }
                    ]
                }
            };
            
            // 中文词典模拟数据
            const chineseMockData = {
                "zdic": {
                    word: word,
                    phonetic: "píng guǒ",
                    definitions: [
                        {
                            partOfSpeech: "名词",
                            meanings: [
                                "落叶乔木，叶椭圆形，有锯齿，花白微红，果实圆形，味甜，是普通的水果。",
                                "这种植物的果实。"
                            ],
                            examples: [
                                "这个苹果很甜。",
                                "苹果富含维生素。"
                            ]
                        }
                    ]
                },
                "baidu": {
                    word: word,
                    phonetic: "píng guǒ",
                    definitions: [
                        {
                            partOfSpeech: "名词",
                            meanings: [
                                "蔷薇科苹果属植物，落叶乔木，果实球形，味甜或略酸，是常见水果。",
                                "这种植物的果实。"
                            ],
                            examples: [
                                "她每天吃一个苹果。",
                                "苹果树在春天开花。"
                            ]
                        }
                    ]
                },
                "cidian": {
                    word: word,
                    phonetic: "píng guǒ",
                    definitions: [
                        {
                            partOfSpeech: "名词",
                            meanings: [
                                "一种常见水果，圆形，红色或绿色，味道甜或酸甜。",
                                "苹果树的果实。"
                            ],
                            examples: [
                                "这个苹果很脆。",
                                "苹果可以做成苹果派。"
                            ]
                        }
                    ]
                },
                "guoxue": {
                    word: word,
                    phonetic: "píng guǒ",
                    definitions: [
                        {
                            partOfSpeech: "名词",
                            meanings: [
                                "蔷薇科苹果属植物，果实圆形，味甘。",
                                "这种植物的果实，可生食或加工。"
                            ],
                            examples: [
                                "《本草纲目》中有关于苹果的记载。",
                                "苹果的营养价值很高。"
                            ]
                        }
                    ]
                }
            };
            
            const mockData = 
                language === 'english' ? englishMockData : 
                language === 'japanese' ? japaneseMockData : 
                chineseMockData;
            
            return mockData[dictionaryId] || {
                word: word,
                phonetic: "N/A",
                definitions: [
                    {
                        partOfSpeech: "未知",
                        meanings: ["未找到相关定义"],
                        examples: []
                    }
                ]
            };
        }

        // 初始化页面
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('searchInput');
            const searchBtn = document.getElementById('searchBtn');
            const dictionaryResults = document.getElementById('dictionaryResults');
            const dictionarySelector = document.getElementById('dictionarySelector');
            const selectAll = document.getElementById('selectAll');
            const modeRadios = document.querySelectorAll('input[name="searchMode"]');
            const languageRadios = document.querySelectorAll('input[name="languageMode"]');
            const englishOption = document.getElementById('englishOption');
            const japaneseOption = document.getElementById('japaneseOption');
            const chineseOption = document.getElementById('chineseOption');
            const selectedResults = document.getElementById('selectedResults');
            const selectedItemsContainer = document.getElementById('selectedItems');
            
            // 更新词典选择器
            function updateDictionarySelector() {
                dictionarySelector.innerHTML = '';
                
                currentDictionaries.forEach(dict => {
                    const checkboxContainer = document.createElement('div');
                    checkboxContainer.className = 'dictionary-checkbox';
                    
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.id = `dict-${dict.id}`;
                    checkbox.dataset.dict = dict.id;
                    checkbox.checked = dict.enabled;
                    
                    const label = document.createElement('label');
                    label.htmlFor = `dict-${dict.id}`;
                    label.textContent = dict.name;
                    
                    checkboxContainer.appendChild(checkbox);
                    checkboxContainer.appendChild(label);
                    
                    dictionarySelector.appendChild(checkboxContainer);
                });
                
                // 重新创建词典结果容器
                createDictionaryResultContainers();
            }
            
            // 创建词典结果容器
            function createDictionaryResultContainers() {
                dictionaryResults.innerHTML = '';
                
                currentDictionaries.forEach(dict => {
                    const container = document.createElement('div');
                    container.className = 'dictionary-result';
                    container.id = `result-${dict.id}`;
                    
                    const header = document.createElement('div');
                    header.className = 'dictionary-header';
                    
                    const nameSpan = document.createElement('span');
                    nameSpan.className = 'dictionary-name';
                    nameSpan.textContent = dict.name;
                    
                    const selectionControl = document.createElement('div');
                    selectionControl.className = 'selection-control';
                    
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.id = `select-${dict.id}`;
                    checkbox.dataset.dict = dict.id;
                    checkbox.addEventListener('change', handleSelectionChange);
                    
                    const label = document.createElement('label');
                    label.htmlFor = `select-${dict.id}`;
                    label.textContent = '选择';
                    
                    selectionControl.appendChild(checkbox);
                    selectionControl.appendChild(label);
                    
                    header.appendChild(nameSpan);
                    header.appendChild(selectionControl);
                    
                    const content = document.createElement('div');
                    content.className = 'dictionary-content';
                    content.id = `content-${dict.id}`;
                    
                    container.appendChild(header);
                    container.appendChild(content);
                    
                    dictionaryResults.appendChild(container);
                });
                
                // 更新选择模式
                updateSelectionMode();
            }
            
            // 处理选择变化
            function handleSelectionChange(e) {
                const dictId = e.target.dataset.dict;
                const isSelected = e.target.checked;
                
                // 更新选中状态
                if (isSelected) {
                    // 如果是单选模式，先取消其他所有选择
                    if (document.getElementById('singleMode').checked) {
                        document.querySelectorAll('.dictionary-header input[type="radio"]').forEach(radio => {
                            if (radio.dataset.dict !== dictId) {
                                radio.checked = false;
                                const container = document.getElementById(`result-${radio.dataset.dict}`);
                                if (container) container.classList.remove('selected');
                            }
                        });
                    }
                    
                    // 添加选中状态
                    const container = document.getElementById(`result-${dictId}`);
                    if (container) container.classList.add('selected');
                    
                    // 添加到已选择列表
                    addToSelectedItems(dictId);
                } else {
                    // 移除选中状态
                    const container = document.getElementById(`result-${dictId}`);
                    if (container) container.classList.remove('selected');
                    
                    // 从已选择列表中移除
                    removeFromSelectedItems(dictId);
                }
                
                // 更新已选择结果区域的显示
                updateSelectedResults();
            }
            
            // 添加到已选择列表
            function addToSelectedItems(dictId) {
                // 如果已经在列表中，先移除
                removeFromSelectedItems(dictId);
                
                const dict = currentDictionaries.find(d => d.id === dictId);
                const content = document.getElementById(`content-${dictId}`).innerHTML;
                
                selectedItems.push({
                    id: dictId,
                    name: dict.name,
                    content: content
                });
            }
            
            // 从已选择列表中移除
            function removeFromSelectedItems(dictId) {
                selectedItems = selectedItems.filter(item => item.id !== dictId);
            }
            
            // 更新已选择结果区域
            function updateSelectedResults() {
                selectedItemsContainer.innerHTML = '';
                
                if (selectedItems.length > 0) {
                    selectedResults.style.display = 'block';
                    
                    selectedItems.forEach(item => {
                        const selectedItem = document.createElement('div');
                        selectedItem.className = 'selected-item';
                        
                        const header = document.createElement('div');
                        header.className = 'selected-item-header';
                        
                        const nameSpan = document.createElement('span');
                        nameSpan.className = 'selected-dictionary-name';
                        nameSpan.textContent = item.name;
                        
                        const removeBtn = document.createElement('button');
                        removeBtn.className = 'remove-btn';
                        removeBtn.innerHTML = '×';
                        removeBtn.addEventListener('click', () => {
                            const checkbox = document.getElementById(`select-${item.id}`);
                            if (checkbox) {
                                checkbox.checked = false;
                                checkbox.dispatchEvent(new Event('change'));
                            }
                        });
                        
                        header.appendChild(nameSpan);
                        header.appendChild(removeBtn);
                        
                        const content = document.createElement('div');
                        content.innerHTML = item.content;
                        
                        selectedItem.appendChild(header);
                        selectedItem.appendChild(content);
                        
                        selectedItemsContainer.appendChild(selectedItem);
                    });
                } else {
                    selectedResults.style.display = 'none';
                }
            }
            
            // 语言切换功能
            languageRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    currentLanguage = this.value;
                    currentDictionaries = dictionaryConfig[currentLanguage];
                    selectedItems = []; // 清空已选择项
                    
                    // 更新UI状态
                    englishOption.classList.remove('active');
                    japaneseOption.classList.remove('active');
                    chineseOption.classList.remove('active');
                    
                    if (currentLanguage === 'english') {
                        englishOption.classList.add('active');
                        searchInput.placeholder = "输入要查询的英文单词...";
                    } else if (currentLanguage === 'japanese') {
                        japaneseOption.classList.add('active');
                        searchInput.placeholder = "入力する単語を入力してください...";
                    } else {
                        chineseOption.classList.add('active');
                        searchInput.placeholder = "输入要查询的中文词语...";
                    }
                    
                    // 更新词典选择器
                    updateDictionarySelector();
                    
                    // 清空搜索结果
                    document.querySelectorAll('.dictionary-result').forEach(container => {
                        container.classList.remove('active');
                    });
                    
                    // 隐藏已选择结果区域
                    selectedResults.style.display = 'none';
                });
            });
            
            // 搜索功能
            searchBtn.addEventListener('click', performSearch);
            searchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    performSearch();
                }
            });
            
            async function performSearch() {
                const query = searchInput.value.trim();
                if (!query) {
                    alert('请输入要查询的单词');
                    return;
                }
                
                // 获取选中的词典
                const selectedDicts = Array.from(dictionarySelector.querySelectorAll('input[type="checkbox"]'))
                    .filter(cb => cb.checked)
                    .map(cb => cb.dataset.dict);
                
                if (selectedDicts.length === 0) {
                    alert('请至少选择一个词典');
                    return;
                }
                
                // 清空已选择项
                selectedItems = [];
                updateSelectedResults();
                
                // 隐藏所有词典容器
                document.querySelectorAll('.dictionary-result').forEach(container => {
                    container.classList.remove('active');
                    container.classList.remove('selected');
                });
                
                // 重置所有选择框
                document.querySelectorAll('.dictionary-header input').forEach(input => {
                    input.checked = false;
                });
                
                // 显示选中的词典并加载内容
                for (const dictId of selectedDicts) {
                    const container = document.getElementById(`result-${dictId}`);
                    const content = document.getElementById(`content-${dictId}`);
                    
                    container.classList.add('active');
                    
                    // 显示加载状态
                    content.innerHTML = '<div class="loading">正在加载...</div>';
                    
                    try {
                        // 获取词典内容
                        const data = await fetchDictionaryContent(dictId, query, currentLanguage);
                        
                        // 显示解析后的内容
                        content.innerHTML = renderDictionaryContent(data, currentLanguage);
                    } catch (error) {
                        content.innerHTML = `<div class="error">加载失败: ${error.message}</div>`;
                    }
                }
            }
            
            // 渲染词典内容
            function renderDictionaryContent(data, language) {
                let html = `
                    <div class="word-header">
                        <div class="word">${data.word}</div>
                        <div class="phonetic">${data.phonetic}</div>
                    </div>
                `;
                
                data.definitions.forEach(def => {
                    html += `<div class="part-of-speech">${def.partOfSpeech}</div>`;
                    
                    def.meanings.forEach((meaning, index) => {
                        html += `<div class="definition">${index + 1}. ${meaning}</div>`;
                    });
                    
                    if (def.examples && def.examples.length > 0) {
                        def.examples.forEach(example => {
                            html += `<div class="example">${example}</div>`;
                        });
                    }
                });
                
                return html;
            }
            
            // 选择模式切换
            modeRadios.forEach(radio => {
                radio.addEventListener('change', updateSelectionMode);
            });
            
            function updateSelectionMode() {
                const isSingleMode = document.getElementById('singleMode').checked;
                const checkboxes = document.querySelectorAll('.dictionary-header input');
                
                if (isSingleMode) {
                    // 单选模式 - 将所有checkbox改为radio
                    checkboxes.forEach(cb => {
                        cb.type = 'radio';
                        cb.name = 'dictionaryRadio';
                    });
                } else {
                    // 多选模式 - 将所有radio改为checkbox
                    checkboxes.forEach(cb => {
                        cb.type = 'checkbox';
                        cb.removeAttribute('name');
                    });
                }
                
                // 清空已选择项
                selectedItems = [];
                updateSelectedResults();
                
                // 移除所有选中状态
                document.querySelectorAll('.dictionary-result').forEach(container => {
                    container.classList.remove('selected');
                });
                
                // 取消所有选择
                checkboxes.forEach(cb => {
                    cb.checked = false;
                });
            }
            
            // 全选功能
            selectAll.addEventListener('change', function() {
                const checkboxes = document.querySelectorAll('.dictionary-header input');
                checkboxes.forEach(cb => {
                    cb.checked = selectAll.checked;
                    cb.dispatchEvent(new Event('change'));
                });
            });
            
            // 初始化词典选择器
            updateDictionarySelector();
        });
    </script>
</body>
</html>